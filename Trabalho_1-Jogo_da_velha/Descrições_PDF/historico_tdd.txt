# Histórico TDD - Jogo da Velha

Data de atualização: 2025-09-19
Branch atual: feature/check-undefined-game

## Etapas já realizadas

1. Estrutura inicial recomposta após perda de arquivos.
2. Reescrita do Makefile com targets: test, coverage, cppcheck, cpplint, valgrind, debug, all-checks, clean.
3. Criação do header `velha.hpp` com documentação e guarda de inclusão.
4. Implementação RED inicial: `verificaVelha` retornava 0; teste do tabuleiro vazio esperando -1.
5. GREEN: Implementação detecção de tabuleiro vazio retornando -1 (estado indefinido).
6. Expansão de lógica para casos impossíveis: contagem inválida, valores fora do domínio, diferença de jogadas ilegal.
7. Detecção de múltiplos vencedores simultâneos (impossível -> -2).
8. Verificação de coerência entre vitória e contagem (X vence => X = O + 1; O vence => X = O).
9. Refatoração: extração de helpers internos (contaJogadas, venceuLinha, venceuColuna, venceuDiagonal, venceu) inicialmente em namespace anônimo.
10. Exposição opcional dos helpers via namespace `velha_internal` em `velha.hpp` para permitir testes granulares e facilitar manutenção.
11. Ajuste de `velha.cpp` para usar namespace `velha_internal` em vez de namespace anônimo.

## Estado atual da função `verificaVelha`
- Retorna -1 se tabuleiro totalmente vazio.
- Retorna -2 para:
  - Valores inválidos fora do conjunto {0,1,2}.
  - Diferença de contagem de X e O que não seja permitida (X inicia: dif. > 1 ou O > X).
  - Dois vencedores simultâneos.
  - Vitória incompatível com contagem.
- Retorna 0 para todos os demais casos (placeholder: ainda não diferencia vitórias, empate, outros indefinidos).

## Próximos passos recomendados (em ciclos TDD)

Ordem sugerida de novos testes (cada um inicia com RED):
1. RED: X vence primeira linha retorna 1.
   GREEN: Detectar vitórias de X (linhas).
   REFACTOR: Reuso da lógica para colunas/diagonais.
2. RED: O vence primeira coluna retorna 2.
   GREEN: Generalizar verificação para O.
3. RED: X vence diagonal principal retorna 1.
   GREEN: Implementar checagem de diagonais (se ainda não feita).
4. RED: Empate (tabuleiro cheio sem vencedor) retorna 0.
   GREEN: Implementar detecção de empate (nenhum vencedor e tabuleiro cheio).
5. RED: Jogo ainda indefinido (existe espaço vazio e nenhuma impossibilidade) retorna -1.
   GREEN: Diferenciar verdadeiros indefinidos de placeholder 0 atual.
6. RED: Jogo impossível por dois vencedores simultâneos (caso específico adicional) retorna -2 (já coberto, mas adicionar teste explícito).
7. RED: Jogo impossível por contagem (ex: O > X) retorna -2 (teste explícito para cobertura).
8. REFACTOR: Extrair avaliação de estado para função auxiliar pura que retorna enum interno (para clareza e manutenção).
9. REFACTOR: Melhorar nomes e remover magic numbers (-1, -2) via enum/constexpr (mantendo interface externa).
10. Qualidade: Atingir >=80% cobertura com novos testes.

## Sugestões de commits futuros (nomes)
- RED: X wins first row should return 1
- GREEN: Implement row win detection for X
- REFACTOR: Unify row/column win checks
- RED: O wins first column should return 2
- GREEN: Implement column win detection for O
- RED: X wins main diagonal should return 1
- GREEN: Implement diagonal win detection
- RED: Draw board should return 0
- GREEN: Implement draw detection
- RED: Non-terminal board should return -1
- GREEN: Implement non-terminal detection
- REFACTOR: Extract state evaluation helper
- REFACTOR: Replace literals -1/-2 with internal enum

## Observações
- Manter granularidade dos commits (RED → GREEN → REFACTOR).
- Atualizar histórico sempre que um ciclo for concluído.
- Considerar remover exposição de `velha_internal` antes da entrega final se não for exigido testar helpers separadamente.

## Próximo passo imediato sugerido
Criar teste RED para vitória de X em uma linha e garantir falha atual (retorno 0) antes de implementar vitória.

-- Fim do arquivo --



RED: adicionar teste para vitória simples de X (ex: linha 0: {1,1,1}) esperando retorno 1.
GREEN: alterar o bloco final de verificaVelha para:
if (xVenceu) return 1;
if (oVenceu) return 2;
if (!existeVazio) return 0; // empate
RED: adicionar teste para vitória de O (com contagem coerente).
GREEN: já deverá passar.
RED: adicionar vitória em coluna e diagonal (garante cobertura de todas as formas).
Refactor: possivelmente extrair enum interno ou constantes constexpr int VITORIA_X = 1; etc., e remover placeholder.